<!DOCTYPE html>
<html lang="en">
  <head>
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="/stylesheets/bootstrap.min.css" rel="stylesheet" media="screen">
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="/javascripts/bootstrap.min.js"></script>
		<link href="/stylesheets/bootstrap-responsive.min.css" rel="stylesheet">
		<script src="/socket.io/socket.io.js"></script>
    <title>Login</title>
  </head>
  <body style="background-image:url('/images/bg00.jpg');">
  	<div class="container-fluid">
  		<div class="row-fluid">
  			<div class="span12 text-center">
					<legend><h3>Call your friends</h3></legend>
					<p>E-mail you want to call:</p>
					<input class="to" type="text" placeholder="user@host.com">
					<button class="btn btn-large btn-success">Call</button>
					<button class="btn btn-large btn-danger">Hang up</button>
					<hr>
					<pre class="preStatus">Call status</pre>
  			</div>
  		</div>
  	</div>
  </body>
	<script>
	  var socket = io.connect('http://localhost');
	  var from = (new Date()).getMilliseconds()+"@peer.com";
	  var to = $('.to').text();

	  //Register in the server
	  var TIME_REGISTER_IVAL = 2000;
	  var amIRegistered = false;
	  var registerInterval = setInterval(function(){
	  	if(amIRegistered==true){
	  		clearInterval(registerInterval);
	  		console.log("...registration succesfull.");
	  		return;
	  	}
	  	console.log("Registering...");
	  	socket.emit('register', {email: from}); // try to register.
	  }, TIME_REGISTER_IVAL);
  	socket.on('status', function (data) {
  		if(data.event == "register" && data.status == "200 OK")
				amIRegistered = true;
		});
	  
	  //Make a call (invite) 
	  socket.emit('invite', {to: "to@peer.com"});
	</script>
</html>